#!/usr/bin/env ruby

require "rubygems"
begin
  require "nokogiri"
rescue => e
  puts "nokogiri is not installed! #{e.message}"
  puts "run:"
  puts "  gem install nokogiri"
  puts
  exit 1
end

xml_file_path = ARGV[0]
xml_file =
  if xml_file_path.nil?
    # xml as stdin stream
    require "stringio"
    xml = StringIO.new
    while line = gets
      xml.write(line)
    end
    xml.rewind
    xml
  elsif xml_file_path && !File.exist?(xml_file_path)
    # filename as argument
    puts "file: #{xml_file_path.inspect} does not exist"
    exit 1
  else
    File.open(xml_file_path, "r")
  end

doc = Nokogiri::XML.parse(xml_file, &:noblanks)
puts doc.to_xhtml(encoding: "UTF-8", indent: 2)
